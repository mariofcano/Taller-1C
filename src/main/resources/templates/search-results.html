<!DOCTYPE html>
<!--
    PLANTILLA DE RESULTADOS DE BUSQUEDA PARA EL SISTEMA DE BIBLIOTECA DIGITAL

    ESTA PAGINA MUESTRA LOS RESULTADOS DE LAS BUSQUEDAS REALIZADAS POR LOS USUARIOS
    DESDE LA PAGINA PRINCIPAL. DISEÑO UNA INTERFAZ CLARA Y ORGANIZADA QUE PERMITE
    A LOS USUARIOS EXPLORAR LOS LIBROS ENCONTRADOS DE MANERA EFICIENTE.

    LA PLANTILLA INCLUYE FUNCIONALIDADES COMO:
    - VISUALIZACION DE RESULTADOS EN FORMATO DE TARJETAS
    - INFORMACION COMPLETA DE CADA LIBRO (TITULO, AUTOR, CATEGORIA, DESCRIPCION)
    - INDICADORES DE DISPONIBILIDAD PARA PRESTAMO
    - OPCIONES DE NAVEGACION Y NUEVA BUSQUEDA
    - MANEJO DE CASOS SIN RESULTADOS CON SUGERENCIAS

    UTILIZO BOOTSTRAP 5 PARA CREAR UN DISEÑO RESPONSIVO Y ATRACTIVO
    QUE FUNCIONA CORRECTAMENTE EN DISPOSITIVOS MOVILES Y DE ESCRITORIO.

    @author MARIO FLORES
    @version 1.0
    @since 2025-05-27
-->
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- CONFIGURACION BASICA DEL DOCUMENTO HTML -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados de Búsqueda - Biblioteca Digital</title>

    <!-- IMPORTACION DE FRAMEWORKS CSS EXTERNOS -->
    <!-- UTILIZO BOOTSTRAP 5 PARA EL SISTEMA DE GRID Y COMPONENTES RESPONSIVOS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FONT AWESOME PARA ICONOGRAFIA PROFESIONAL Y CONSISTENTE -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <!-- ESTILOS PERSONALIZADOS PARA LA IDENTIDAD VISUAL DEL SISTEMA -->
    <style>
        /* TARJETAS DE RESULTADOS CON EFECTOS VISUALES ATRACTIVOS */
        .result-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            height: 100%;
        }

        /* ANIMACION DE ELEVACION AL HACER HOVER EN LAS TARJETAS */
        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        /* ESTILOS PARA BADGES DE CATEGORIA */
        .category-badge {
            font-size: 0.8rem;
            padding: 0.4rem 0.8rem;
        }

        /* ESTILOS PARA INDICADORES DE DISPONIBILIDAD */
        .availability-indicator {
            font-weight: bold;
            font-size: 0.9rem;
        }

        /* SECCION DE BUSQUEDA CON FONDO SUAVE */
        .search-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 2rem 0;
            margin-bottom: 2rem;
        }

        /* ESTILOS PARA MENSAJES DE ESTADO */
        .search-message {
            font-size: 1.1rem;
            font-weight: 500;
        }

        /* DESCRIPCION TRUNCADA PARA MANTENER UNIFORMIDAD */
        .book-description {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.4;
            max-height: 4.2rem;
        }

        /* TITULO DEL LIBRO CON LIMITE DE LINEAS */
        .book-title {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.3;
            max-height: 2.6rem;
            font-weight: 600;
        }
    </style>
</head>
<body>
<!--
    BARRA DE NAVEGACION PRINCIPAL DEL SISTEMA

    IMPLEMENTO UNA NAVBAR CONSISTENT CON EL RESTO DEL SITIO QUE PERMITE
    NAVEGACION FACIL ENTRE LAS DIFERENTES SECCIONES. INCLUYO ENLACES
    DESTACADOS PARA VOLVER AL INICIO Y ACCEDER AL CATALOGO COMPLETO.
-->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <!-- MARCA DE LA BIBLIOTECA CON ICONO REPRESENTATIVO -->
        <a class="navbar-brand" href="/">
            <i class="fas fa-book-reader me-2"></i>
            Biblioteca Digital
        </a>

        <!-- BOTON PARA MENU HAMBURGUESA EN DISPOSITIVOS MOVILES -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- CONTENIDO COLAPSIBLE DE LA NAVEGACION -->
        <div class="collapse navbar-collapse" id="navbarNav">
            <!-- ENLACES DE NAVEGACION PRINCIPALES -->
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/">
                        <i class="fas fa-home me-1"></i>
                        Inicio
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="/catalog">
                        <i class="fas fa-book me-1"></i>
                        Catálogo
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/contact">
                        <i class="fas fa-envelope me-1"></i>
                        Contacto
                    </a>
                </li>
            </ul>

            <!-- ENLACES DE AUTENTICACION ALINEADOS A LA DERECHA -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="/login">
                        <i class="fas fa-sign-in-alt me-1"></i>
                        Iniciar Sesión
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/register">
                        <i class="fas fa-user-plus me-1"></i>
                        Registrarse
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!--
    SECCION DE ENCABEZADO DE BUSQUEDA

    MUESTRO INFORMACION SOBRE LA BUSQUEDA REALIZADA Y PROPORCIONO
    LA OPCION DE REALIZAR UNA NUEVA BUSQUEDA SIN SALIR DE LA PAGINA.
    ESTO MEJORA LA EXPERIENCIA DE USUARIO AL PERMITIR REFINAMIENTO
    RAPIDO DE LOS CRITERIOS DE BUSQUEDA.
-->
<div class="search-header">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-6">
                <!-- INFORMACION SOBRE LA BUSQUEDA ACTUAL -->
                <h1 class="h3 mb-2">
                    <i class="fas fa-search text-primary me-2"></i>
                    Resultados de Búsqueda
                </h1>
                <p class="search-message text-muted mb-0" th:if="${searchTerm}">
                    Búsqueda: "<strong th:text="${searchTerm}">término</strong>"
                </p>
                <p class="search-message text-muted" th:text="${searchMessage}">
                    Mensaje de estado de la búsqueda
                </p>
            </div>
            <div class="col-md-6">
                <!-- FORMULARIO PARA NUEVA BUSQUEDA -->
                <form method="post" action="/search" class="d-flex">
                    <input type="text" name="searchTerm" class="form-control me-2"
                           placeholder="Nueva búsqueda..." th:value="${searchTerm}" required>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- CONTENIDO PRINCIPAL CON RESULTADOS DE BUSQUEDA -->
<div class="container my-4">
    <!--
        MANEJO DE ERRORES DE BUSQUEDA

        SI OCURRE ALGUN ERROR DURANTE LA BUSQUEDA, MUESTRO UN MENSAJE
        CLARO AL USUARIO EXPLICANDO LA SITUACION Y PROPORCIONANDO
        ALTERNATIVAS PARA CONTINUAR NAVEGANDO.
    -->
    <div th:if="${searchError}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-triangle me-2"></i>
        <span th:text="${searchError}">Error en la búsqueda</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!--
        RESULTADOS DE BUSQUEDA ENCONTRADOS

        MUESTRO LOS LIBROS ENCONTRADOS EN UN GRID RESPONSIVO UTILIZANDO
        TARJETAS DE BOOTSTRAP. CADA TARJETA CONTIENE INFORMACION COMPLETA
        DEL LIBRO Y INDICADORES VISUALES DE DISPONIBILIDAD.
    -->
    <div th:if="${searchResults != null and !searchResults.isEmpty()}">
        <!-- CONTADOR DE RESULTADOS PARA ORIENTACION DEL USUARIO -->
        <div class="row mb-4">
            <div class="col-12">
                <p class="h5 text-muted">
                    <i class="fas fa-list-ul me-2"></i>
                    <span th:text="${resultCount}">0</span> resultado(s) encontrado(s)
                </p>
            </div>
        </div>

        <!-- GRID DE RESULTADOS CON TARJETAS DE LIBROS -->
        <div class="row g-4">
            <!-- ITERACION SOBRE CADA LIBRO ENCONTRADO -->
            <div class="col-md-6 col-lg-4" th:each="book : ${searchResults}">
                <div class="card result-card">
                    <div class="card-body">
                        <!-- TITULO DEL LIBRO CON LIMITACION DE LINEAS -->
                        <h5 class="card-title book-title text-primary" th:text="${book.title}">
                            Título del Libro
                        </h5>

                        <!-- INFORMACION DEL AUTOR CON ICONO IDENTIFICATIVO -->
                        <p class="card-text text-muted mb-2">
                            <i class="fas fa-user me-1"></i>
                            <strong>Autor:</strong> <span th:text="${book.author}">Autor</span>
                        </p>

                        <!-- CATEGORIA DEL LIBRO COMO BADGE COLORIDO -->
                        <div class="mb-2">
                                <span class="badge bg-info category-badge" th:text="${book.category.description}">
                                    Categoría
                                </span>
                        </div>

                        <!-- DESCRIPCION TRUNCADA DEL LIBRO -->
                        <p class="card-text book-description text-muted"
                           th:if="${book.description}" th:text="${book.description}">
                            Descripción del libro que se trunca automáticamente...
                        </p>

                        <!-- INFORMACION ADICIONAL DEL LIBRO -->
                        <div class="mb-3">
                            <!-- EDITORIAL Y FECHA DE PUBLICACION -->
                            <small class="text-muted d-block" th:if="${book.publisher}">
                                <i class="fas fa-building me-1"></i>
                                <span th:text="${book.publisher}">Editorial</span>
                                <span th:if="${book.publicationDate}">
                                        (<span th:text="${#temporals.year(book.publicationDate)}">2023</span>)
                                    </span>
                            </small>

                            <!-- NUMERO DE PAGINAS -->
                            <small class="text-muted d-block" th:if="${book.pages}">
                                <i class="fas fa-file-alt me-1"></i>
                                <span th:text="${book.pages}">300</span> páginas
                            </small>

                            <!-- IDIOMA DEL LIBRO -->
                            <small class="text-muted d-block" th:if="${book.language}">
                                <i class="fas fa-language me-1"></i>
                                Idioma: <span th:text="${book.language}">ES</span>
                            </small>
                        </div>

                        <!-- INDICADOR DE DISPONIBILIDAD -->
                        <div class="d-flex justify-content-between align-items-center">
                            <!-- ESTADO DE DISPONIBILIDAD CON COLORES -->
                            <div th:if="${book.availableCopies > 0}">
                                    <span class="availability-indicator text-success">
                                        <i class="fas fa-check-circle me-1"></i>
                                        Disponible
                                    </span>
                                <small class="text-muted d-block">
                                    <span th:text="${book.availableCopies}">3</span> de
                                    <span th:text="${book.totalCopies}">5</span> copias
                                </small>
                            </div>
                            <div th:unless="${book.availableCopies > 0}">
                                    <span class="availability-indicator text-danger">
                                        <i class="fas fa-times-circle me-1"></i>
                                        No disponible
                                    </span>
                                <small class="text-muted d-block">
                                    Todas las copias prestadas
                                </small>
                            </div>

                            <!-- BOTON PARA MAS INFORMACION -->
                            <button class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-info-circle me-1"></i>
                                Detalles
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ENLACE AL CATALOGO COMPLETO PARA CONTINUAR EXPLORANDO -->
        <div class="text-center mt-5">
            <a href="/catalog" class="btn btn-primary btn-lg">
                <i class="fas fa-book-open me-2"></i>
                Ver Catálogo Completo
            </a>
        </div>
    </div>

    <!--
        MENSAJE CUANDO NO HAY RESULTADOS

        SI LA BUSQUEDA NO ARROJA RESULTADOS, MUESTRO UN MENSAJE EXPLICATIVO
        CON SUGERENCIAS PARA AYUDAR AL USUARIO A ENCONTRAR LO QUE BUSCA.
    -->
    <div th:if="${searchResults != null and searchResults.isEmpty()}" class="text-center py-5">
        <!-- ICONO GRANDE PARA CAPTAR ATENCION -->
        <i class="fas fa-search fa-4x text-muted mb-4"></i>

        <!-- MENSAJE PRINCIPAL DE NO RESULTADOS -->
        <h3 class="text-muted mb-3">No se encontraron resultados</h3>

        <!-- MENSAJE EXPLICATIVO CON EL TERMINO BUSCADO -->
        <p class="lead text-muted mb-4">
            No encontramos libros que coincidan con "<strong th:text="${searchTerm}">término de búsqueda</strong>".
        </p>

        <!-- SUGERENCIAS PARA MEJORAR LA BUSQUEDA -->
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-lightbulb text-warning me-2"></i>
                            Sugerencias para tu búsqueda:
                        </h5>
                        <ul class="list-unstyled text-start">
                            <li class="mb-2">
                                <i class="fas fa-check text-success me-2"></i>
                                Verifica la ortografía de las palabras
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check text-success me-2"></i>
                                Intenta con términos más generales
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check text-success me-2"></i>
                                Usa sinónimos o palabras relacionadas
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check text-success me-2"></i>
                                Busca por autor, título o género
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- BOTONES DE ACCION ALTERNATIVA -->
        <div class="mt-4">
            <a href="/" class="btn btn-primary me-3">
                <i class="fas fa-home me-2"></i>
                Volver al Inicio
            </a>
            <a href="/catalog" class="btn btn-outline-primary">
                <i class="fas fa-book me-2"></i>
                Explorar Catálogo
            </a>
        </div>
    </div>

    <!--
        MENSAJE CUANDO NO SE HA REALIZADO BUSQUEDA

        SI EL USUARIO ACCEDE DIRECTAMENTE A ESTA PAGINA SIN REALIZAR
        UNA BUSQUEDA, MUESTRO UN MENSAJE EXPLICATIVO Y LO REDIRIJO
        A SECCIONES MAS APROPIADAS DEL SITIO.
    -->
    <div th:if="${searchResults == null}" class="text-center py-5">
        <i class="fas fa-question-circle fa-4x text-muted mb-4"></i>
        <h3 class="text-muted mb-3">No hay búsqueda activa</h3>
        <p class="lead text-muted mb-4">
            Realiza una búsqueda para ver resultados aquí.
        </p>

        <!-- FORMULARIO DE BUSQUEDA CENTRADO -->
        <div class="row justify-content-center">
            <div class="col-md-6">
                <form method="post" action="/search" class="d-flex">
                    <input type="text" name="searchTerm" class="form-control me-2"
                           placeholder="Buscar libros, autores, géneros..." required>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!--
    FOOTER INFORMATIVO DEL SISTEMA

    MANTENGO CONSISTENCIA CON EL RESTO DEL SITIO INCLUYENDO
    EL MISMO FOOTER EN TODAS LAS PAGINAS. PROPORCIONA
    INFORMACION INSTITUCIONAL Y CREDITOS DEL SISTEMA.
-->
<footer class="bg-dark text-light py-4 mt-5">
    <div class="container">
        <div class="row">
            <!-- COLUMNA IZQUIERDA CON INFORMACION DE LA MARCA -->
            <div class="col-md-6">
                <!-- TITULO CON ICONO REPRESENTATIVO -->
                <h5>
                    <i class="fas fa-book-reader me-2"></i>
                    Biblioteca Digital
                </h5>
                <!-- DESCRIPCION BREVE DEL SISTEMA Y TECNOLOGIAS UTILIZADAS -->
                <p>Sistema de gestión bibliográfica desarrollado con Spring Boot y Thymeleaf.</p>
            </div>

            <!-- COLUMNA DERECHA CON CREDITOS DE DESARROLLO -->
            <div class="col-md-6 text-md-end">
                <p class="mb-0">
                    <!-- ICONO DE CODIGO PARA REPRESENTAR DESARROLLO -->
                    <i class="fas fa-code me-1"></i>
                    Desarrollado por Mario Flores - 2025
                </p>
            </div>
        </div>
    </div>
</footer>

<!--
    SCRIPTS DE JAVASCRIPT PARA FUNCIONALIDAD INTERACTIVA

    CARGO BOOTSTRAP JAVASCRIPT BUNDLE QUE INCLUYE:
    - COMPONENTES INTERACTIVOS COMO MODALES Y ALERTS
    - FUNCIONALIDAD DE NAVEGACION RESPONSIVE
    - ANIMACIONES Y TRANSICIONES SUAVES
    - COMPATIBILIDAD CON TODOS LOS NAVEGADORES MODERNOS

    UTILIZO LA VERSION BUNDLE QUE INCLUYE POPPER.JS INTEGRADO
    PARA EVITAR CONFLICTOS DE DEPENDENCIAS.
-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!--
    SCRIPT PERSONALIZADO PARA FUNCIONALIDADES ADICIONALES

    AÑADO JAVASCRIPT PERSONALIZADO PARA MEJORAR LA EXPERIENCIA
    DE USUARIO CON FUNCIONALIDADES COMO AUTO-DISMISS DE ALERTAS
    Y EFECTOS VISUALES ADICIONALES.
-->
<script>
    // AUTO-DISMISS DE ALERTAS DESPUES DE 5 SEGUNDOS
    document.addEventListener('DOMContentLoaded', function() {
        // BUSCO TODAS LAS ALERTAS EN LA PAGINA
        const alerts = document.querySelectorAll('.alert');

        alerts.forEach(function(alert) {
            // CONFIGURO AUTO-DISMISS PARA CADA ALERTA
            setTimeout(function() {
                const bsAlert = new bootstrap.Alert(alert);
                if (bsAlert) {
                    bsAlert.close();
                }
            }, 5000); // 5 SEGUNDOS
        });

        // EFECTO DE FADE-IN PARA LAS TARJETAS DE RESULTADOS
        const resultCards = document.querySelectorAll('.result-card');
        resultCards.forEach(function(card, index) {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';

            setTimeout(function() {
                card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100); // DELAY ESCALONADO PARA EFECTO SECUENCIAL
        });

        // FOCUS AUTOMATICO EN EL CAMPO DE BUSQUEDA SI NO HAY RESULTADOS
        if (document.querySelector('.search-header input[name="searchTerm"]')) {
            const searchInput = document.querySelector('.search-header input[name="searchTerm"]');
            // SOLO HACER FOCUS SI NO HAY RESULTADOS O HAY ERROR
            if (document.querySelector('.alert-danger') ||
                document.querySelector('h3:contains("No se encontraron resultados")')) {
                searchInput.focus();
                searchInput.select();
            }
        }
    });

    // FUNCION PARA MOSTRAR DETALLES DEL LIBRO (PLACEHOLDER)
    function showBookDetails(bookId) {
        // TODO: IMPLEMENTAR MODAL O PAGINA DE DETALLES DEL LIBRO
        console.log('Mostrando detalles del libro ID:', bookId);
        alert('Funcionalidad de detalles del libro próximamente disponible');
    }

    // MEJORAR ACCESIBILIDAD CON NAVEGACION POR TECLADO
    document.addEventListener('keydown', function(e) {
        // ACCESO RAPIDO CON TECLAS
        if (e.ctrlKey || e.metaKey) {
            switch(e.key) {
                case 'k':
                    e.preventDefault();
                    // FOCUS EN EL CAMPO DE BUSQUEDA
                    const searchInput = document.querySelector('input[name="searchTerm"]');
                    if (searchInput) {
                        searchInput.focus();
                        searchInput.select();
                    }
                    break;
            }
        }
    });
</script>
</body>
</html>